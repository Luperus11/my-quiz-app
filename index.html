<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocab Master - Intelligent SRS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'ChulaCharasNew', sans-serif; }
        .card { border: none; border-radius: 1.2rem; box-shadow: 0 8px 30px rgba(0,0,0,0.05); }
        .stat-card { background: white; padding: 1.5rem; border-radius: 1rem; text-align: center; height: 100%; }
        .mode-badge { padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; text-transform: uppercase; }
        .bg-vocab { background-color: #e3f2fd; color: #0d6efd; border: 1px solid #0d6efd; }
        .bg-sentence { background-color: #fff3e0; color: #ef6c00; border: 1px solid #ef6c00; }
        .hidden { display: none !important; }
        .progress { height: 8px; border-radius: 10px; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ */
        .btn-suggest { 
            transform: scale(1.15); 
            border-width: 3px !important; 
            font-weight: bold !important;
            box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
            z-index: 5;
        }

        @keyframes pulse-red {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        .mic-active { animation: pulse-red 1.5s infinite; background-color: #dc3545 !important; color: white !important; border-color: #dc3545 !important; }
        
        .btn-speaker {
            cursor: pointer;
            transition: 0.2s;
            color: #0d6efd;
        }
        .btn-speaker:hover { transform: scale(1.2); color: #004bb5; }
    </style>
</head>
<body>
    <div class="container my-4" style="max-width: 800px;">
        <div id="app-root"></div>
    </div>

    <div class="modal fade" id="startModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header border-0"><h5 class="fw-bold">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <label class="form-label small fw-bold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                    <select id="cat-select" class="form-select mb-3"></select>
                    <div id="progress-info" class="p-3 bg-light rounded-3 small"></div>
                </div>
                <div class="modal-footer border-0">
                    <button id="confirm-start" class="btn btn-primary w-100 py-2 fw-bold">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ</button>
                </div>
            </div>
        </div>
    </div>

    <template id="tmp-main">
        <div class="row g-3 mb-4">
            <div class="col-4"><div class="stat-card"> <h3 class="text-primary fw-bold" id="st-total">0</h3><small class="text-muted">‡∏Ñ‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small> </div></div>
            <div class="col-4"><div class="stat-card"> <h3 class="text-warning fw-bold" id="st-due">0</h3><small class="text-muted">‡∏£‡∏≠‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</small> </div></div>
            <div class="col-4"><div class="stat-card"> <h3 class="text-danger fw-bold" id="st-streak">0</h3><small class="text-muted">Streak</small> </div></div>
        </div>
        <div class="card p-4 mb-4">
            <h6 class="fw-bold mb-3"><i class="bi bi-graph-up"></i> ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h6>
            <div style="height: 150px;"><canvas id="chart-activity"></canvas></div>
        </div>
        <div class="card p-3 mb-4 bg-white border-start border-danger border-4">
            <h6 class="fw-bold text-danger mb-2 small"><i class="bi bi-exclamation-octagon"></i> ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡∏¢‡πâ‡∏≥)</h6>
            <div id="weak-list" class="small text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
        </div>
        <div class="d-grid gap-2">
            <button onclick="App.openStart()" class="btn btn-primary btn-lg py-3 rounded-4 shadow-sm fw-bold">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</button>
            <div class="row g-2">
                <div class="col-6"><button onclick="App.render('manage')" class="btn btn-outline-secondary py-2 w-100">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button></div>
                <div class="col-6"><button onclick="App.clearData()" class="btn btn-outline-danger py-2 w-100">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</button></div>
            </div>
        </div>
    </template>

    <template id="tmp-test">
        <div class="card overflow-hidden shadow-lg border-0">
            <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center py-3">
                <div id="mode-indicator" class="mode-badge">...</div>
                <div class="fw-bold text-muted small">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å <span id="q-left">0</span></div>
            </div>
            <div class="progress rounded-0 bg-light"><div id="q-progress" class="progress-bar bg-primary" style="width: 0%"></div></div>
            <div class="card-body text-center py-5">
                <p id="q-hint" class="text-muted mb-2"></p>
                <h2 id="q-text" class="display-6 fw-bold mb-4"></h2>
                
                <div id="input-area" class="px-4">
                    <div class="input-group mb-3">
                        <input type="text" id="ans-input" class="form-control form-control-lg text-center shadow-sm" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡πÑ‡∏°‡∏Ñ‡πå..." autocomplete="off">
                        <button id="mic-btn" onclick="App.handleMic()" class="btn btn-outline-primary px-4"><i class="bi bi-mic-fill"></i></button>
                    </div>
                    <button onclick="App.checkAns()" class="btn btn-dark btn-lg w-100 py-3 rounded-3 fw-bold">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
                </div>

                <div id="feedback-area" class="hidden">
                    <h1 id="fb-title" class="fw-bold mb-1"></h1>
                    <div id="speed-feedback" class="mb-3"></div>
                    <div class="bg-light p-3 rounded-3 mb-4 position-relative">
                        <small class="text-muted">‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏∑‡∏≠:</small>
                        <h2 class="text-dark fw-bold mb-0">
                            <span id="fb-ans"></span>
                            <i class="bi bi-volume-up-fill btn-speaker ms-2" onclick="App.speak(document.getElementById('fb-ans').textContent)"></i>
                        </h2>
                    </div>
                    <div id="srs-action-area"></div>
                </div>
            </div>
        </div>
    </template>

    <template id="tmp-manage">
        <button onclick="App.render('main')" class="btn btn-link text-decoration-none text-dark mb-2 px-0"><i class="bi bi-chevron-left"></i> ‡∏Å‡∏•‡∏±‡∏ö</button>
        <div class="card p-3 mb-3">
            <h6 class="fw-bold mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡πÉ‡∏´‡∏°‡πà</h6>
            <form id="add-form" class="row g-2 small">
                <div class="col-8"><input type="text" class="form-control" placeholder="‡πÇ‡∏à‡∏ó‡∏¢‡πå" required></div>
                <div class="col-4">
                    <select class="form-select">
                        <option value="word">‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</option>
                        <option value="sentence">‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ</option>
                    </select>
                </div>
                <div class="col-6"><input type="text" class="form-control" placeholder="‡πÄ‡∏â‡∏•‡∏¢" required></div>
                <div class="col-6"><input type="text" class="form-control" placeholder="‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ" required></div>
                <div class="col-12"><div class="input-group"><input type="text" class="form-control" placeholder="‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà" required><button class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></div>
            </form>
        </div>
        <div id="man-list" class="list-group shadow-sm small"></div>
    </template>

    <script>
        const App = {
            qs: [], his: [], cur: null, session: [],
            startTime: null,

            init() {
                this.qs = JSON.parse(localStorage.getItem('vMaster_qs') || '[]');
                this.his = JSON.parse(localStorage.getItem('vMaster_his') || '[]');
                if(this.qs.length < 12) this.seedData();
                this.render('main');
            },

            seedData() {
                const data = [
                    { q: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°', a: 'effort', h: 'E _ _ _ _ T', c: 'General', t: 'word' },
                    { q: 'It takes a lot of ___.', a: 'effort', h: '‡∏°‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å', c: 'General', t: 'sentence' },
                    { q: '‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏™‡∏ö‡∏≤‡∏¢', a: 'convenient', h: 'c _ _ _ _ _ _ _ _ t', c: 'Lifestyle', t: 'word' },
                    { q: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢', a: 'challenge', h: 'c _ _ _ _ _ _ _ e', c: 'Mindset', t: 'word' },
                    { q: '‡πÇ‡∏≠‡∏Å‡∏≤‡∏™', a: 'opportunity', h: 'o _ _ _ _ _ _ _ _ _ y', c: 'Career', t: 'word' },
                    { q: '‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô', a: 'necessary', h: 'n _ _ _ _ _ _ _ y', c: 'General', t: 'word' },
                    { q: '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', a: 'recommend', h: 'r _ _ _ _ _ _ _ d', c: 'Social', t: 'word' },
                    { q: 'This is a great ___ for you.', a: 'opportunity', h: '‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì', c: 'Career', t: 'sentence' },
                    { q: 'Is it ___ for you to meet now?', a: 'convenient', h: '‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏û‡∏ö‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°?', c: 'Lifestyle', t: 'sentence' },
                    { q: 'I highly ___ this restaurant.', a: 'recommend', h: '‡∏â‡∏±‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏¥‡πà‡∏á', c: 'Social', t: 'sentence' },
                    { q: 'It is ___ to follow the rules.', a: 'necessary', h: '‡∏°‡∏±‡∏ô‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏Å‡∏é', c: 'General', t: 'sentence' },
                    { q: 'Learning English is a ___.', a: 'challenge', h: '‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢', c: 'Mindset', t: 'sentence' }
                ];
                this.qs = data.map((d, i) => ({
                    id: Date.now() + i, type: d.t, question: d.q, answer: d.a, hint: d.h, category: d.c,
                    srs_level: 0, next_review: new Date().toISOString(), wrong_count: 0
                }));
                this.save();
            },

            save() { 
                localStorage.setItem('vMaster_qs', JSON.stringify(this.qs)); 
                localStorage.setItem('vMaster_his', JSON.stringify(this.his)); 
            },

            clearData() {
                if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) {
                    localStorage.clear();
                    location.reload();
                }
            },

            render(p) {
                const root = document.getElementById('app-root');
                root.innerHTML = document.getElementById(`tmp-${p}`).innerHTML;
                if(p === 'main') this.loadMain();
                if(p === 'manage') this.loadMan();
            },

            loadMain() {
                const due = this.qs.filter(q => new Date(q.next_review) <= new Date()).length;
                document.getElementById('st-total').textContent = this.qs.length;
                document.getElementById('st-due').textContent = due;
                document.getElementById('st-streak').textContent = this.his.length > 0 ? "1" : "0";

                const weakOnes = [...this.qs].sort((a,b) => b.wrong_count - a.wrong_count).filter(q => q.wrong_count > 0).slice(0, 3);
                document.getElementById('weak-list').innerHTML = weakOnes.length > 0 
                    ? weakOnes.map(q => `<div>‚Ä¢ ${q.answer} (‡∏ú‡∏¥‡∏î ${q.wrong_count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div>`).join('')
                    : "‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô";

                new Chart(document.getElementById('chart-activity'), {
                    type: 'line',
                    data: { labels: ['‡∏à.','‡∏≠.','‡∏û.','‡∏û‡∏§.','‡∏®.','‡∏™.','‡∏≠‡∏≤.'], datasets: [{ label: '‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô', data: [0,0,0,0,0,0, due], borderColor: '#0d6efd', fill: true, backgroundColor: 'rgba(13, 110, 253, 0.05)', tension: 0.4 }] },
                    options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
                });
            },

            openStart() {
                const modal = new bootstrap.Modal(document.getElementById('startModal'));
                const mastered = this.qs.filter(q => q.type === 'word' && q.srs_level >= 3).length;
                const sel = document.getElementById('cat-select');
                sel.innerHTML = '<option value="strict">‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö)</option>';
                [...new Set(this.qs.map(q => q.category))].forEach(c => sel.add(new Option(c, c)));
                document.getElementById('progress-info').innerHTML = `‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (L3+): <b>${mastered}/3</b> ‡∏Ñ‡∏≥<br>${mastered >= 3 ? '<span class="text-success">‚úÖ ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÅ‡∏•‡πâ‡∏ß</span>' : '<span class="text-danger">‚ùå ‡∏ù‡∏∂‡∏Å‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ</span>'}`;
                document.getElementById('confirm-start').onclick = () => { modal.hide(); this.startTest(sel.value); };
                modal.show();
            },

            startTest(cat) {
                const masteredCount = this.qs.filter(q => q.type === 'word' && q.srs_level >= 3).length;
                this.session = this.qs.filter(q => {
                    if (masteredCount < 3 && q.type === 'sentence') return false; 
                    return cat === 'strict' ? true : q.category === cat;
                });
                if(this.session.length === 0) return alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô');
                this.totalInSession = this.session.length;
                this.render('test');
                this.nextQ();
            },

            nextQ() {
                this.cur = this.session.shift();
                if(!this.cur) return alert('‡∏à‡∏ö‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß!'), this.render('main');
                document.getElementById('ans-input').value = '';
                document.getElementById('input-area').classList.remove('hidden');
                document.getElementById('feedback-area').classList.add('hidden');
                const mi = document.getElementById('mode-indicator');
                mi.textContent = this.cur.type === 'word' ? '‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå' : '‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ';
                mi.className = `mode-badge ${this.cur.type === 'word' ? 'bg-vocab' : 'bg-sentence'}`;
                document.getElementById('q-left').textContent = this.session.length + 1;
                document.getElementById('q-progress').style.width = `${((this.totalInSession - this.session.length) / this.totalInSession) * 100}%`;
                document.getElementById('q-hint').textContent = this.cur.hint;
                document.getElementById('q-text').textContent = this.cur.question;
                
                this.startTime = Date.now();
                setTimeout(() => {
                    const inp = document.getElementById('ans-input');
                    if(inp) inp.focus();
                }, 400);
            },

            handleMic() {
                const Rec = window.webkitSpeechRecognition || window.SpeechRecognition;
                if (!Rec) return alert("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á");
                const rec = new Rec(); rec.lang = 'en-US';
                const btn = document.getElementById('mic-btn');
                rec.onstart = () => btn.classList.add('mic-active');
                rec.onresult = (e) => {
                    document.getElementById('ans-input').value = e.results[0][0].transcript.replace(/\.$/g, '');
                    setTimeout(() => this.checkAns(), 600);
                };
                rec.onend = () => btn.classList.remove('mic-active');
                rec.start();
            },

            speak(text) {
                const speech = new SpeechSynthesisUtterance(text);
                speech.lang = 'en-US';
                window.speechSynthesis.speak(speech);
            },

            checkAns() {
                const duration = (Date.now() - this.startTime) / 1000;
                const input = document.getElementById('ans-input').value.trim().toLowerCase();
                const isCorrect = input === this.cur.answer.toLowerCase();
                
                document.getElementById('input-area').classList.add('hidden');
                document.getElementById('feedback-area').classList.remove('hidden');
                
                const title = document.getElementById('fb-title');
                const speedBox = document.getElementById('speed-feedback');
                const actionArea = document.getElementById('srs-action-area');
                document.getElementById('fb-ans').textContent = this.cur.answer;

                if(isCorrect) {
                    title.textContent = "‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! üéâ";
                    title.className = "fw-bold text-success";
                    
                    let speedHTML = "";
                    let recLv = 0;

                    if(duration <= 3.5) {
                        speedHTML = "<span class='badge bg-success'><i class='bi bi-lightning-charge-fill'></i> ‡∏ï‡∏≠‡∏ö‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å!</span>";
                        recLv = 6;
                    } else if(duration <= 7.5) {
                        speedHTML = "<span class='badge bg-primary'><i class='bi bi-hand-thumbs-up-fill'></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏î‡∏µ</span>";
                        recLv = 4;
                    } else {
                        speedHTML = "<span class='badge bg-warning text-dark'><i class='bi bi-hourglass-split'></i> ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏∂‡∏Å‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢</span>";
                        recLv = 2;
                    }
                    speedBox.innerHTML = speedHTML;

                    let btns = `<p class='small text-muted mb-2'>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ L${recLv}):</p><div class='d-flex justify-content-center flex-wrap align-items-center' style='min-height: 80px;'>`;
                    for(let i=1; i<=6; i++) {
                        const isRec = i === recLv;
                        btns += `<button onclick="App.setLv(${i})" class="btn ${isRec ? 'btn-primary btn-suggest' : 'btn-outline-primary'} m-2">L${i}</button>`;
                    }
                    btns += '</div>';
                    actionArea.innerHTML = btns;
                } else {
                    title.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ô‡∏∞! ‚ùå";
                    title.className = "fw-bold mb-3 text-danger";
                    speedBox.innerHTML = "";
                    this.cur.wrong_count++;
                    actionArea.innerHTML = `<button onclick="App.setLv(1)" class="btn btn-danger w-100 py-3 fw-bold">‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà (‡∏•‡∏î‡πÄ‡∏õ‡πá‡∏ô L1)</button>`;
                }

                this.speak(this.cur.answer);
            },

            setLv(lv) {
                const target = this.qs.find(q => q.id === this.cur.id);
                target.srs_level = lv;
                const days = [0, 0, 0.1, 1, 3, 7, 30][lv] || 1;
                target.next_review = new Date(Date.now() + days * 86400000).toISOString();
                this.his.unshift({ date: new Date().toISOString(), ans: this.cur.answer, lv: lv });
                this.save();
                this.nextQ();
            },

            loadMan() {
                const list = document.getElementById('man-list');
                list.innerHTML = this.qs.map(q => `
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div><div class="fw-bold">${q.answer}</div><div class="small text-muted">${q.question}</div></div>
                        <span class="badge ${q.type==='word'?'bg-vocab':'bg-sentence'}">L${q.srs_level}</span>
                    </div>
                `).join('');
                document.getElementById('add-form').onsubmit = (e) => {
                    e.preventDefault();
                    const f = e.target;
                    this.qs.push({
                        id: Date.now(), question: f[0].value, type: f[1].value, answer: f[2].value, hint: f[3].value, category: f[4].value,
                        srs_level: 0, next_review: new Date().toISOString(), wrong_count: 0
                    });
                    this.save(); this.loadMan(); f.reset();
                };
            }
        };

        App.init();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
